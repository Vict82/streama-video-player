angular.module("streama.videoPlayer",[]);"use strict";angular.module("streama.videoPlayer").directive("streamaVideoPlayer",["localStorageService","$timeout","$http",function(b,a,c){return{restrict:"AE",templateUrl:"/templates/player/streama-video-player.directive.html",scope:{options:"="},link:function(p,S,F){var i;var h;var L;var s;var l;var N=null;var O=20;var A=60;var E=true;var D=true;var m=p.options.videoSrc.toString();p.showControls=k;p.toggleSelectEpisodes=H;p.createNewPlayerSession=f;p.toggleTextTrack=C;p.playerVolumeToggle=J;p.play=w;p.pause=e;p.closeVideo=x;p.clickVideo=j;p.fullScreen=G;p.next=p.options.onNext;p.isInitialized=false;p.loading=true;p.initialPlay=false;c.head(m).success(function(){n()}).error(function(U,T){if(T==406){p.options.onError("FILE_IN_FS_NOT_FOUND")}});function n(){p.isInitialized=true;S.addClass("nocursor");if(!p.options.isTouch){I();K()}Q();P();p.volumeLevel=b.get("volumeLevel")||5;p.$on("$destroy",y);p.$on("$stateChangeSuccess",t);a(function(){var T=S.find("video");T.bind("contextmenu",function(){return false});i=T[0];i.oncanplay=B;i.onwaiting=d;i.onplaying=M;i.onerror=z;i.ontimeupdate=g;i.addEventListener("ended",u);p.scrubberOptions=R();p.volumeScrubberOptions=v()})}function k(){S.removeClass("nocursor");a.cancel(h);a.cancel(L);p.controlsVisible=true;p.overlayVisible=false;h=a(function(){p.controlsVisible=false;if(!p.playing){L=a(function(){if(!p.playing){p.overlayVisible=true}},5000)}else{S.addClass("nocursor")}},1000)}function R(){return{orientation:"horizontal",min:0,max:255,range:"min",change:function(U,T){angular.element("#playerDurationSlider .ui-slider-handle").blur()},stop:function(U,T){angular.element("#playerDurationSlider .ui-slider-handle").blur();i.currentTime=T.value;p.currentTime=T.value;p.options.onTimeChange(T,p.videoDuration)}}}function v(){return{orientation:"vertical",range:"min",change:function(U,T){q(T);angular.element("#playerVolumeSlider .ui-slider-handle").blur()},slide:function(U,T){q(T);angular.element("#playerVolumeSlider .ui-slider-handle").blur()}}}function x(){if(p.isFullScreen==true){p.fullScreen()}p.options.onClose()}function j(){p.options.onVideoClick()}function G(){var U;var V=document;if(p.isMobile){U=i}else{U=document.documentElement}var T=window.innerHeight==screen.height;if(!T){p.isFullScreen=true;if(U.requestFullscreen){U.requestFullscreen()}else{if(U.mozRequestFullScreen){U.mozRequestFullScreen()}else{if(U.webkitRequestFullScreen){U.webkitRequestFullScreen()}else{if(U.msRequestFullscreen){U.msRequestFullscreen()}}}}}else{p.isFullScreen=false;if(V.exitFullscreen){V.exitFullscreen()}else{if(V.mozCancelFullScreen){V.mozCancelFullScreen()}else{if(V.webkitExitFullscreen){V.webkitExitFullscreen()}else{if(V.msExitFullscreen){V.msExitFullscreen()}}}}}}function q(U){var T=U.value/10;i.volume=T;if(p.options.rememberVolumeSetting){b.set("volumeLevel",p.volumeLevel)}}function J(){if(p.volumeLevel==0){p.volumeLevel=5}else{p.volumeLevel=0}}function Q(){p.$on("triggerVideoPlay",function(U,T){p.play(T)});p.$on("triggerVideoPause",function(U,T){p.pause(T)});p.$on("triggerVideoToggle",function(U,T){if(p.playing){p.pause(T)}else{p.play(T)}});p.$on("triggerVideoTimeChange",function(U,T){i.currentTime=T.currentPlayerTime;p.currentTime=T.currentPlayerTime})}function t(U,T){if(T.name!="player"){if(p.isFullScreen=true){p.fullScreen()}}}function y(){Mousetrap.reset();console.log("destroy");i.pause();i.src="";S.find("video").children("source").prop("src","");S.find("video").remove().length=0}function g(T){p.currentTime=i.currentTime;p.$apply();if(E){if(N==null){N=p.options.currentEpisode}if(N.intro_start<this.currentTime&&this.currentTime<N.intro_end){i.currentTime=N.intro_end}}}function u(){if(p.options.showNextButton){p.options.onNext()}}function z(){if(!i.duration&&!p.initialPlay){p.options.onError()}}function M(){p.loading=false}function B(){if(!p.initialPlay){p.canplay=true;console.log("%c oncanplay","color: deeppink; font-weight: bold; text-shadow: 0 0 5px deeppink;");p.loading=false;if(!p.isMobile){p.play()}else{p.pause()}p.videoDuration=i.duration;i.currentTime=p.options.customStartingTime||0;p.currentTime=i.currentTime;p.initialPlay=true;if(p.options.videoTrack){i.textTracks[0].mode="hidden"}}}function d(){p.loading=true}function H(T){p.options.selectedEpisodes=T}function e(T){i.pause();p.playing=false;p.options.onPause(i,T)}function w(T){i.play();p.playing=true;p.options.onPlay(i,T);p.overlayVisible=false}function f(){p.options.onSocketSessionCreate()}function C(){p.isTextTrackVisible=!p.isTextTrackVisible;if(p.isTextTrackVisible){i.textTracks[0].mode="showing"}else{i.textTracks[0].mode="hidden"}}function o(T){p.volumeChanged=true;a.cancel(s);p.volumeLevel+=T;p.volumeLevel=p.volumeLevel.clamp(0,10);p.$apply();s=a(function(){p.volumeChanged=false},1500)}function P(){p.isMobile=false;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))){p.isMobile=true}}function r(){p.currentTimeChanged=true;p.options.onTimeChange(i.currentTime,p.videoDuration);a.cancel(l);p.$apply();l=a(function(){p.currentTimeChanged=false},10000)}function I(){jQuery(S).mousewheel(function(T){if(T.deltaY>0){o(1)}else{if(T.deltaY<0){o(-1)}}p.showControls()})}function K(){Mousetrap.bind("left",function(T){T.preventDefault();r();i.currentTime-=O},"keyup");Mousetrap.bind("right",function(T){T.preventDefault();r();i.currentTime+=O},"keyup");Mousetrap.bind("ctrl+right",function(T){T.preventDefault();r();i.currentTime+=A},"keyup");Mousetrap.bind("ctrl+left",function(T){T.preventDefault();r();i.currentTime-=A},"keyup");Mousetrap.bind("alt+enter",function(T){T.preventDefault();p.fullScreen()});Mousetrap.bind(["backspace","del"],function(T){T.preventDefault();p.closeVideo()});Mousetrap.bind("s",function(T){T.preventDefault();p.toggleTextTrack()});Mousetrap.bind("up",function(T){T.preventDefault();o(1)});Mousetrap.bind("down",function(T){T.preventDefault();o(-1)});Mousetrap.bind("m",function(T){T.preventDefault();p.playerVolumeToggle();p.showControls()});Mousetrap.bind("e",function(T){T.preventDefault();p.toggleSelectEpisodes();p.showControls()});Mousetrap.bind("space",function(){if(p.playing){p.pause()}else{p.play()}p.$apply()})}}}}]);